<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Google fonts -->
  <link href='http://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'>
  <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,300,400italic,400,600" rel="stylesheet" type="text/css">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      blm.io &middot; blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="atom.xml">

  <!-- add this -->
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5398cddd3691288f"></script>

  <!-- Custom JS, charting libs and jquery -->
  <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js' type='text/javascript'></script>
  <script src='http://d3js.org/d3.v3.min.js' type='text/javascript'></script>
  <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
  <script>
  $(document).ready( function() {

    $('.gallery-item').hover( function() {
      $(this).find('.img-title').fadeIn(300);
    }, function() {
      $(this).find('.img-title').fadeOut(100);
    });

  });
  </script>


  <!-- begin analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51522691-1', 'blm.io');
  ga('require', 'displayfeatures');
  ga('send', 'pageview')
  </script>
  <!-- end analytics -->
</head>


<body>
<div id="header">
  <nav>
    <ul>
      <li><a href="http://blm.io">front</a></li>
      <li><a href="http://blm.io/projects">projects</a></li>
      <li><a href="http://benjaminlmoore.wordpress.com" target="_blank">blog</a></li>
      <li><a href="http://blm.io/contact">contact</a></li>
    </ul>
  </nav>
</div>  

<div class="container content">
  <!--

  <div class="masthead">
  <h3 class="masthead-title">
  <a href="" title="Home">blm.io</a>
  <small></small>
</h3>
</div>
-->


<div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/r/wikipedia/2014/02/03/meticulously-recreating-bitmap-plots-in-r/">
        Meticulously recreating bitmap plots in R
      </a>
    </h1>

    <span class="post-date-paginate">03 Feb 2014</span>

    <p>There's a hard-fought drive on Wikimedia commons to convert those images that should be in vector format (i.e. graphs, diagrams) from their current bitmap form. At the time of writing, the relevant category has over <a href="https://commons.wikimedia.org/wiki/Category:Images_that_should_use_vector_graphics" target="_blank">7000</a> images in the category "Images that should use vector graphics".</p>

<p>The usual way people move between the two is by tracing over the raster, and great tools like <a href="http://www.inkscape.org/en/" target="_blank">Inkscape</a> (free open-source software) can help a lot with this. But in the case of graphs I thought it'd be fun to try and rebuild a carbon copy from scratch in R.</p>

<h2>The original</h2>

<p><a href="http://benjaminlmoore.files.wordpress.com/2014/02/original.png"><img class="size-large wp-image-400" alt="This is the original bitmap plot I wanted to recreate." src="img/original.png?w=500" width="500" height="343" /></a> This is the original bitmap plot I wanted to recreate.
<em>(Courtesy of <a href="https://commons.wikimedia.org/wiki/File:US_EmpStatsBLS_Jan09-Feb13.png" target="_blank">Wikimedia Commons</a>)</em></p>

<p>The file that first caught my eye was this nice graph of US employment stats, currently used on the highly-trafficked <a href="https://en.wikipedia.org/wiki/Barack_Obama" target="_blank">Obama article</a>. I'm not sure what drew this originally, it doesn't look like Excel because of the broken axis and annotations, but maybe it is. It's currently a png at about 700 × 500 so should be an easy target for improvement.</p>

<h2>Figure 2.0</h2>

<p>The two raw data files are available <a href="http://data.bls.gov/timeseries/LNS14000000" target="_blank">here</a> and <a href="http://data.bls.gov/timeseries/CES0000000001?output_view=net_1mth" target="_blank">here</a> as Excel spreadsheets. They have some weird unnecessary formatting so the various xls parsers for R won't work; save the tables from Excel as csv. I won't talk through the code as it wasn't too taxing (or clean) but it'll be at the end of the post. Here's what I came up with:</p>

<p><a href="https://upload.wikimedia.org/wikipedia/commons/2/25/US_Employment_Statistics.svg"><img class="size-large wp-image-427 " alt="I realise the irony in having to upload a bitmap version for wordpress, but click for the SVG." src="img/recre_v5.png?w=500" width="500" height="349" /></a> I realise the irony in having to upload a bitmap version for wordpress, but click for the SVG.</p>

<p>I expanded my plot to include the 2013 data, so it inescapably has slightly different proportions to the original. And I was working on a single monitor at the time so I didn't have a constant comparison. I can see now a few things are still off, the fonts are different sized for one and I ditched the broken axis, but overall I think it's a decent similarity!</p>

<h2>ggplot2 version</h2>

<p>Two y-axes on the same graph is bad, bad, bad and unsurprisingly forbidden with ggplot2 but I did come across <a href="http://rwiki.sciviews.org/doku.php?id=tips:graphics-ggplot2:aligntwoplots" target="_blank">this</a> method of dummy-facetting and then plotting separate layers per facet. An obvious problem is now the y-axis are representing different things and you only have one label. A hacky fix is to write your ylabs into the facet header (I'm 100% confident Hadley Wickham and Leland Wilkinson would not be impressed with this). Another alternative would be to use map a colour aesthetic to your y-axis values and label it in the legend (again, pretty far from recommended practice).</p>

<p>This is what I ended up with, I still think it's a reasonable alternative to the above, and the loess fitted model nicely shows the unemployment rate trend without the seasonality effects:</p>

<p><a href="http://benjaminlmoore.files.wordpress.com/2014/02/ggplot_bitmap.png"><img class="aligncenter size-large wp-image-413" alt="ggplot_bitmap" src="img/ggplot_bitmap.png" width="500" height="432" /></a></p>

<h2>Article version</h2>

<p>While mimicking the original exactly was fun (for me at least), I tried to improve upon it for the actual final figure for use on Wikipedia. For instance, it now uses unambiguous month abbreviations, and I swapped the legend for colour-coded text labels. It still has some of the original's charm though. Looks like after a bit of a rough patch, your employment statistics are starting to look pretty good Mr. President.</p>

<p><a href="http://benjaminlmoore.files.wordpress.com/2014/02/new_v2.png"><img class="aligncenter size-large wp-image-431" alt="new_v2" src="img/new_v2.png?w=500" width="500" height="332" /></a></p>

<p>Next up, the other <em>much</em> less attractive figures on that page ([<a href="https://en.wikipedia.org/wiki/File:U.S._Total_Deficits_vs._National_Debt_Increases_2001-2010.png" target="_blank">1</a>], [<a href="https://en.wikipedia.org/wiki/File:PPACA_Premium_Chart.jpg" target="_blank">2</a>]).</p>

<hr />

<p style="text-align:right;">Code available in a <a href="https://gist.github.com/blmoore/8794075" target="_blank">gist</a>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/wikipedia/2014/01/09/wikipedia-is-dead-long-live-the-pedia/">
        Wikipedia is dead, long live the 'pedia
      </a>
    </h1>

    <span class="post-date-paginate">09 Jan 2014</span>

    <p>I was a bit surprised when looking at the Wikipedia pageviews for 2013 (nicely presented <a href="http://reportcard.wmflabs.org/" target="_blank">here</a>). After 5 years of consistent and reasonably stable growth, over 2013 monthly pageviews actually dropped, and to the tune of 2 *billion* views  (10%) from their peak early in the year.</p>

<p><a href="http://benjaminlmoore.files.wordpress.com/2014/01/pviews.png"><img class="aligncenter size-full wp-image-378" alt="pviews" src="img/pviews.png" width="500" height="352" /></a>This was surprising to me. The problem Wikipedia has attracting new editors has been <a href="http://www.technologyreview.com/featuredstory/520446/the-decline-of-wikipedia/" target="_blank">well-publicised</a>, but it's never had trouble with PageRank or increasing its reach to casual viewers.</p>

<p>Well, it turns out one area seeing consistent and healthy growth is, as you would guess, mobile views, which are showing gains of about 150k pageviews a month on English Wikipedia. This makes up for almost half a billion of those lost over 2013 in the graph above, but still leaves some explaining to do.</p>

<p><a href="http://benjaminlmoore.files.wordpress.com/2014/01/mobile1.png"><img class="aligncenter size-full wp-image-383" alt="mobile" src="img/mobile1.png" width="500" height="352" /></a></p>

<p>Interestingly, another useful metric of web traffic, unique visitors per month, continues to <a href="http://reportcard.wmflabs.org/" target="_blank">grow considerably</a>. Maybe this reflects how mobile visitors use the site differently, just looking something up (e.g. to settle an argument) and closing their browser as opposed to a few hours going from topic to topic and ending up admiring a <a href="https://en.wikipedia.org/wiki/List_of_Eiffel_Tower_replicas" target="_blank">list of Eiffel tower replicates</a>.</p>

<p><img class="alignright  wp-image-386" alt="mvvu" src="img/mvvu.png" width="360" height="254" /></p>

<p>A quick graph of mean monthly pageviews per visitor gives this theory some support, but the data seems pretty noisy and has varied a lot over the past few years.</p>

<p>Another possibility is that this data is telling us what we already know: the unique visitors with the highest total page views must be the article writers and the <a href="https://en.wikipedia.org/wiki/Wikipedia:WikiGnome" target="_blank">Wikignomes</a> that built the place — and they've been in precipitous decline for nearly <a href="https://en.wikipedia.org/wiki/File:Wikipedia_editor_numbers.svg" target="_blank">6 years now</a>. I'm speculating of course, but maybe that's starting to show through on the page views site-wide, emphasising how much work a small group of people have been putting in, and the dent they're leaving in Wikipedia as they leave.</p>

<hr />

<p>Have I missed something, do you have a better idea of why en.wiki pageviews fell over 2013? Let me know!</p>

<h5>Full <code>R</code> code to reproduce the graphs shown in this post is here:</h5>

<p>https://gist.github.com/blmoore/8343067</p>

  </div>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    
      <a class="pagination-item newer" href="">Newer</a>
    
  
</div>


<div class="footer">
  <p>
    <!--
    <a href="https://creativecommons.org/licenses/by/4.0/"
    target="_blank">CC-BY 4.0</a> 2014.
  -->
  </p>
  </div>
  </div>

  </body>
  </html>
